# workflows/ingest_workflow.yaml

main:
  steps:
    - call_ingest:
        try:
          call: http.post
          args:
            url: ${INGEST_URL}
            auth:
              type: OIDC
          result: ingest_response
        retry:
          predicate: ${http.default_retry_predicate}   # retry on 5xx, 429, etc. 
          max_retries: 5                                # up to 5 attempts total 
          backoff:
            initial_delay: 10                           # wait 10 s before 2nd try 
            max_delay: 60                               # cap wait at 60 s 
            multiplier: 2                               # exponential backoff multiplier 

    - success_log:
        return: "load-ok"
